name: Deploy React Assignments to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Build all Vite projects
        run: |
          mkdir -p gh-pages
          for dir in $(find . -type f -name package.json -path "./week*/*" -exec dirname {} \;)
          do
            echo "Building $dir"
            cd $dir
            npm install
            npm run build
            cd ../../
            week=$(basename $(dirname $dir))
            proj=$(basename $dir)
            mkdir -p gh-pages/$week/$proj
            cp -r $dir/dist/* gh-pages/$week/$proj/
          done

      - name: Upload gh-pages folder
        uses: actions/upload-pages-artifact@v3
        with:
          path: gh-pages

  deploy-pages:
    runs-on: ubuntu-latest
    needs: deploy
    steps:
      - uses: actions/deploy-pages@v4
        id: deployment
